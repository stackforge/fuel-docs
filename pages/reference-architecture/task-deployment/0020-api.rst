.. _0020-api:

API
---

If you want to change or add some tasks right on
the Fuel Master node, just add the *tasks.yaml* file
and respective manifests in the folder for the release that you are interested in.
Then run the following command:

::
    fuel rel --sync-deployment-tasks --dir /etc/puppet

Also you may want to overwrite the deployment tasks for any specific
release/cluster using the following commands:

::
    fuel rel --rel <id> --deployment-tasks --download
    fuel rel --rel <id> --deployment-tasks --upload

    fuel env --env <id> --deployment-tasks --download
    fuel env --env <id> --deployment-tasks --upload

After this is done you will be able to run a customized graph of tasks:

The most basic command:

::
    fuel node --node 1,2,3 --tasks upload_repos netconfig

The developer will need to specify nodes that should be used in deployment and
task IDs. The order in which these are provided does not matter.
It will be computed from the dependencies specified in the database.

..note:: The node will not be executed if a task is mapped to Controller role,
but the node where you want to apply the task does not have this role.

Skipping of tasks
-----------------

Use the *skip* parameter to skip tasks.

Example:

::
    fuel node --node 1,2,3 --skip netconfig hiera

The list of tasks specified with the *skip* parameter will be skipped during
graph traversal in nailgun.

If there are task dependencies, you may want to make use of a "smarter" traversal:

Specify the start and end nodes in the graph:

::
    fuel node --node 1,2,3 --end netconfig

This will deploy everything up to the netconfig task, including netconfig.
This means that this will deploy all tasks that are a part of *pre_deployment*: keys generation, rsync
manifests, sync time, upload repos, including such tasks as hiera setup, globals computation and maybe some other
basic preparatory tasks.

::
    fuel node --node 1,2,3 --start netconfig

Start from netconfig (including netconfig itself), deploy all the tasks that are
 a part of *post_deployment*.

For example, if you want to execute only the netconfig successors:

::
    fuel node --node 1,2,3 --start netconfig --skip netconfig

And the user will be able to use start and end at the same time:

::
    fuel node --node 1,2,3 --start netconfig --end upload_cirros

Nailgun will build a path that includes only thw necessary tasks to join these two
points.
